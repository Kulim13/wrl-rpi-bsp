From 0cb4988dfe652d34b0cb199bea7ba214d86a9939 Mon Sep 17 00:00:00 2001
From: popcornmix <popcornmix@gmail.com>
Date: Thu, 17 Nov 2016 16:49:33 +0000
Subject: [PATCH 167/212] fixup: fb: Use struct device for dma_alloc_coherent

---
 drivers/video/fbdev/bcm2708_fb.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/drivers/video/fbdev/bcm2708_fb.c b/drivers/video/fbdev/bcm2708_fb.c
index 0d22e00..53c5a0b 100644
--- a/drivers/video/fbdev/bcm2708_fb.c
+++ b/drivers/video/fbdev/bcm2708_fb.c
@@ -504,7 +504,7 @@ static long vc_mem_copy(struct bcm2708_fb *fb, unsigned long arg)
 		return -EFAULT;
 	}
 
-	buf = dma_alloc_coherent(NULL, PAGE_ALIGN(size), &bus_addr,
+	buf = dma_alloc_coherent(fb->fb.device, PAGE_ALIGN(size), &bus_addr,
 				 GFP_ATOMIC);
 	if (!buf) {
 		pr_err("[%s]: failed to dma_alloc_coherent(%d)\n",
@@ -528,7 +528,7 @@ static long vc_mem_copy(struct bcm2708_fb *fb, unsigned long arg)
 	}
 out:
 	if (buf)
-		dma_free_coherent(NULL, PAGE_ALIGN(size), buf, bus_addr);
+		dma_free_coherent(fb->fb.device, PAGE_ALIGN(size), buf, bus_addr);
 	return rc;
 }
 
-- 
1.9.1

